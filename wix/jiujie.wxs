<?xml version='1.0' encoding='utf-8'?>
<!--
  Source: https://github.com/peterfei/bevy_card_battler
  Game: 九界：渡劫 (Jiujie: Dujie)
-->

<Wix xmlns='http://schemas.microsoft.com/wix/2006/wi'>
    <Product Id='*' Name='!(loc.ProductName)' UpgradeCode='F50F4705-932B-4FF5-A3E6-34285FC6E6BD' Manufacturer='!(loc.Manufacturer)' Language='2052' Codepage='936' Version='0.1.0'>
        <Package Id='*' Keywords='!(loc.Keywords)' Description='!(loc.Description)' Manufacturer='!(loc.Manufacturer)' InstallerVersion='450' Languages='2052' Compressed='yes' InstallScope='perMachine' SummaryCodepage='936' Platform='x64'/>

        <MajorUpgrade Schedule='afterInstallInitialize' DowngradeErrorMessage='!(loc.DowngradeErrorMessage)'/>

        <Media Id='1' Cabinet='media1.cab' EmbedCab='yes' DiskPrompt='光盘 #1'/>
        <Property Id='DiskPrompt' Value='九界：渡劫 安装程序 [1]'/>

        <Directory Id='TARGETDIR' Name='SourceDir'>
            <Directory Id='ProgramFiles64Folder' Name='PFiles'>
                <Directory Id='APPLICATIONFOLDER' Name='Jiujie'>
                    
                    <!-- 主程序 -->
                    <Component Id='binary0' Guid='191E9B73-F5AD-4554-9D60-4805BF571B55' Win64='yes'>
                        <File Id='exe0' Name='jiujie.exe' DiskId='1' Source='$(var.CargoTargetBinDir)\jiujie.exe' KeyPath='yes'/>
                    </Component>

                    <!-- 许可文件 -->
                    <Component Id='License' Guid='635CC59F-86E8-423B-9176-FF483E104B64' Win64='yes'>
                        <File Id='LicenseFile' Name='License.rtf' DiskId='1' Source='wix\License.rtf' KeyPath='yes'/>
                    </Component>

                    <!-- 资源目录 (新增) -->
                    <Directory Id='AssetsFolder' Name='assets' />
                </Directory>
            </Directory>
            
            <!-- 开始菜单快捷方式目录 -->
            <Directory Id="ProgramMenuFolder">
                <Directory Id="ApplicationProgramsFolder" Name="!(loc.ProductName)"/>
            </Directory>

            <!-- 桌面目录 -->
            <Directory Id="DesktopFolder" Name="Desktop" />
        </Directory>

        <!-- 开始菜单快捷方式组件 -->
        <DirectoryRef Id="ApplicationProgramsFolder">
            <Component Id="ApplicationShortcut" Guid="*">
                <Shortcut Id="ApplicationStartMenuShortcut" 
                          Name="!(loc.ShortcutName)" 
                          Description="!(loc.ShortcutDescription)"
                          Target="[APPLICATIONFOLDER]jiujie.exe"
                          WorkingDirectory="APPLICATIONFOLDER"/>
                <RemoveFolder Id="ApplicationProgramsFolder" On="uninstall"/>
                <RegistryValue Root="HKCU" Key="Software\peterfei\Jiujie" Name="installed" Type="integer" Value="1" KeyPath="yes"/>
            </Component>
        </DirectoryRef>

        <!-- 桌面快捷方式组件 -->
        <DirectoryRef Id="DesktopFolder">
            <Component Id="DesktopShortcut" Guid="*">
                <Shortcut Id="ApplicationDesktopShortcut"
                          Name="!(loc.ShortcutName)"
                          Description="!(loc.ShortcutDescription)"
                          Target="[APPLICATIONFOLDER]jiujie.exe"
                          WorkingDirectory="APPLICATIONFOLDER"/>
                <RegistryValue Root="HKCU" Key="Software\peterfei\Jiujie" Name="desktop_shortcut" Type="integer" Value="1" KeyPath="yes"/>
            </Component>
        </DirectoryRef>

        <!-- 核心功能（主程序 + 资源 + 许可 + 开始菜单） -->
        <Feature Id='MainProgram' Title='!(loc.MainProgramTitle)' Description='!(loc.MainProgramDescription)' Level='1' ConfigurableDirectory='APPLICATIONFOLDER' AllowAdvertise='no' Display='expand' Absent='disallow'>
            <ComponentRef Id='binary0'/>
            <ComponentRef Id='License'/>
            <ComponentRef Id='ApplicationShortcut'/>
            <ComponentGroupRef Id='AssetsComponentGroup'/>
        </Feature>

        <!-- 可选功能（桌面快捷方式） -->
        <Feature Id='DesktopShortcutFeature' Title='创建桌面快捷方式' Description='在桌面添加游戏启动图标' Level='1' AllowAdvertise='no'>
            <ComponentRef Id='DesktopShortcut'/>
        </Feature>

        <SetProperty Id='ARPINSTALLLOCATION' Value='[APPLICATIONFOLDER]' After='CostFinalize'/>

        <!-- 图标 -->
        <Icon Id='ProductICO' SourceFile='assets\icons\favicon.ico'/>
        <Property Id='ARPPRODUCTICON' Value='ProductICO' />

        <!-- UI (切换为 FeatureTree 以支持功能选择) -->
        <UIRef Id='WixUI_FeatureTree'/>
        <WixVariable Id='WixUILicenseRtf' Value='wix\License.rtf'/>

    </Product>
</Wix>
